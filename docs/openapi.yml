openapi: 3.0.3
info:
  title: 콘서트 예약 시스템 API
  description: |
    콘서트 좌석 예약 및 결제 시스템 API 문서

    주요 기능:
    - 콘서트 예약 가능 날짜 및 좌석 조회
    - 좌석 예약 (5분 임시 배정)
    - 포인트 충전 및 조회
    - 결제 처리
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com

servers:
  - url: http://localhost:8080/api/v1
    description: 로컬 개발 서버

tags:
  - name: Concerts
    description: 콘서트 및 일정 관리
  - name: Reservations
    description: 좌석 예약 관리
  - name: Points
    description: 포인트 관리
  - name: Payments
    description: 결제 처리

paths:
  /concerts:
    get:
      tags:
        - Concerts
      summary: 특정 날짜의 예약 가능한 콘서트 조회
      description: 날짜를 입력받아 해당 날짜에 예약 가능한 콘서트 목록을 조회합니다.
      operationId: getConcertsByDate
      parameters:
        - name: date
          in: query
          required: true
          description: 조회할 날짜 (yyyy-MM-dd 형식)
          schema:
            type: string
            format: date
            example: "2025-12-25"
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Concert'
        '400':
          description: 잘못된 날짜 형식
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /concerts/{concertId}/seats:
    get:
      tags:
        - Concerts
      summary: 예약 가능 좌석 조회
      description: 특정 콘서트의 예약 가능한 좌석 정보를 조회합니다. (좌석번호 1-50)
      operationId: getAvailableSeats
      parameters:
        - name: concertId
          in: path
          required: true
          description: 콘서트 ID
          schema:
            type: string
        - name: status
          in: query
          required: false
          description: 좌석 상태 필터 (미지정시 AVAILABLE만 조회)
          schema:
            type: string
            enum: [AVAILABLE, TEMPORARILY_RESERVED, RESERVED]
            example: AVAILABLE
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      concertId:
                        type: string
                        example: "concert-1"
                      concertName:
                        type: string
                        example: "아이유 콘서트"
                      concertDate:
                        type: string
                        format: date-time
                        example: "2025-12-25T19:00:00"
                      venue:
                        type: string
                        example: "올림픽체조경기장"
                      seats:
                        type: array
                        items:
                          $ref: '#/components/schemas/Seat'
        '404':
          description: 콘서트를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /reservations:
    post:
      tags:
        - Reservations
      summary: 좌석 예약 요청
      description: |
        날짜와 좌석 정보를 입력받아 좌석을 예약 처리합니다.
        예약과 동시에 해당 좌석은 5분간 임시 배정됩니다.
        배정 시간 내에 결제가 완료되지 않으면 임시 배정이 해제됩니다.
      operationId: createReservation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReservationRequest'
      responses:
        '201':
          description: 예약 생성 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Reservation'
        '400':
          description: 잘못된 요청 (이미 예약된 좌석 등)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: 좌석을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: 좌석이 이미 예약되어 있음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /users/points:
    get:
      tags:
        - Points
      summary: 포인트 조회
      description: 사용자의 현재 포인트를 조회합니다.
      operationId: getUserPoints
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/UserPoint'
        '404':
          description: 사용자를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /users/charge-point:
    post:
      tags:
        - Points
      summary: 포인트 충전
      description: 사용자의 포인트를 충전합니다.
      operationId: chargePoints
      parameters:
        - name: userId
          in: path
          required: true
          description: 사용자 ID
          schema:
            type: integer
            format: int64
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChargePointRequest'
      responses:
        '200':
          description: 충전 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/UserPoint'
        '400':
          description: 잘못된 요청 (음수 금액 등)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: 사용자를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /payments:
    post:
      tags:
        - Payments
      summary: 결제 처리
      description: |
        결제를 처리하고 결제 내역을 생성합니다.
        결제가 완료되면 해당 좌석의 소유권이 사용자에게 배정되고 대기열 토큰이 만료됩니다.
      operationId: processPayment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentRequest'
      responses:
        '200':
          description: 결제 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Payment'
        '400':
          description: 잘못된 요청 (포인트 부족, 예약 시간 만료 등)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: 예약을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    Concert:
      type: object
      description: 날짜별 콘서트 및 일정 정보
      properties:
        concertId:
          type: string
          description: 콘서트 ID
          example: 1
        concertName:
          type: string
          description: 콘서트 이름
          example: "아이유 콘서트"
        concertDescription:
          type: string
          description: 콘서트 설명
          example: "2025 아이유 전국투어 콘서트"
        concertDate:
          type: string
          format: date-time
          description: 콘서트 날짜 및 시간
          example: "2025-12-25 19:00:00"
        venue:
          type: string
          description: 공연장
          example: "올림픽체조경기장"
        totalSeats:
          type: integer
          description: 전체 좌석 수
          example: 50
        availableSeats:
          type: integer
          description: 예약 가능한 좌석 수
          example: 35

    Seat:
      type: object
      description: 좌석 정보
      properties:
        id:
          type: string
          description: 좌석 ID
          example: concertId-1
        seatNumber:
          type: integer
          description: 좌석 번호 (1-50)
          example: 15
          minimum: 1
          maximum: 50
        status:
          type: string
          enum: [AVAILABLE, TEMPORARILY_RESERVED, RESERVED]
          description: |
            좌석 상태
            - AVAILABLE: 예약 가능
            - TEMPORARILY_RESERVED: 임시 예약 (5분간)
            - RESERVED: 예약 완료
          example: AVAILABLE
        price:
          type: integer
          format: int64
          description: 좌석 가격
          example: 120000

    ReservationRequest:
      type: object
      description: 좌석 예약 요청
      required:
        - concertId
        - seatNumber
      properties:
        concertId:
          type: string
          description: 콘서트 ID
          example: "concert-1"
        seatNumber:
          type: integer
          description: 예약할 좌석 번호 (1-50)
          example: 15
          minimum: 1
          maximum: 50

    Reservation:
      type: object
      description: 예약 정보
      properties:
        id:
          type: string
          description: 예약 ID
        userId:
          type: string
          description: 사용자 ID
          example: userID
        concertId:
          type: string
          description: 콘서트 일정 ID
          example: 1
        seatId:
          type: string
          description: 좌석 ID
          example: 1
        seatNumber:
          type: integer
          description: 좌석 번호
          example: 15
        status:
          type: string
          enum: [TEMPORARY, CONFIRMED, CANCELLED, EXPIRED]
          description: |
            예약 상태
            - TEMPORARY: 임시 예약 (5분간 유효)
            - CONFIRMED: 결제 완료
            - CANCELLED: 취소됨
            - EXPIRED: 시간 만료
          example: TEMPORARY
        price:
          type: integer
          format: int64
          description: 예약 금액
          example: 120000
        reservedAt:
          type: string
          format: date-time
          description: 예약 시간
          example: "2025-12-09 15:00:00"
        expiresAt:
          type: string
          format: date-time
          description: 임시 예약 만료 시간
          example: "2025-12-09 15:05:00Z"

    UserPoint:
      type: object
      description: 사용자 포인트 정보
      properties:
        userId:
          type: integer
          format: int64
          description: 사용자 ID
          example: 1
        balance:
          type: integer
          format: int64
          description: 현재 포인트 잔액
          example: 500000
        updatedAt:
          type: string
          format: date-time
          description: 마지막 업데이트 시간
          example: "2025-12-09 15:00:00"

    ChargePointRequest:
      type: object
      description: 포인트 충전 요청
      required:
        - amount
      properties:
        amount:
          type: integer
          format: int64
          description: 충전할 포인트 금액 (양수)
          example: 100000
          minimum: 1

    PaymentRequest:
      type: object
      description: 결제 요청
      required:
        - reservationId
      properties:
        reservationId:
          type: string
          description: 예약 ID

    Payment:
      type: object
      description: 결제 정보
      properties:
        id:
          type: string
          description: 결제 ID
        userId:
          type: string
          description: 사용자 ID
        reservationId:
          type: string
          description: 예약 ID
        amount:
          type: integer
          format: int64
          description: 결제 금액
          example: 120000
        status:
          type: string
          enum: [COMPLETED, FAILED, CANCELLED]
          description: |
            결제 상태
            - COMPLETED: 결제 완료
            - FAILED: 결제 실패
            - CANCELLED: 결제 취소
          example: COMPLETED
        paidAt:
          type: string
          format: date-time
          description: 결제 시간
          example: "2025-12-09 15:03:00"

    Error:
      type: object
      description: 에러 응답
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          properties:
            code:
              type: string
              description: 에러 코드
              example: "SEAT_ALREADY_RESERVED"
            message:
              type: string
              description: 에러 메시지
              example: "해당 좌석은 이미 예약되었습니다."
